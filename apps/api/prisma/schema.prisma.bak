generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  OFFICER
  SUPERVISOR
  AUDITOR
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  role         Role
  createdAt    DateTime @default(now())

  releaseChecks ReleaseCheck[] @relation("UserReleaseChecks")
  auditRecords  AuditRecord[]  @relation("UserAuditRecords")
}

model ReleaseCheck {
  id                String   @id @default(uuid())
  reference         String
  scheduledReleaseAt DateTime
  createdAt         DateTime @default(now())

  createdById       String
  createdBy         User     @relation("UserReleaseChecks", fields: [createdById], references: [id])

  auditRecords      AuditRecord[]

  @@index([createdById])
  @@index([scheduledReleaseAt])
}

model AuditRecord {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  checkId   String
  check     ReleaseCheck @relation(fields: [checkId], references: [id])

  actorId   String
  actor     User     @relation("UserAuditRecords", fields: [actorId], references: [id])

  action    String
  payload   Json

  prevHash  String?
  hash      String

  @@index([checkId, createdAt])
  @@index([actorId, createdAt])
}
